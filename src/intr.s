
.globl intr_handler_table

intr_dispatch:
	movl intr_handler_table(,%eax,4), %ebx
	testl %ebx, %ebx
	jz 0f
	push %eax
	call *%ebx
	addl $4, %esp
0:	popal
	iret

// explicit 32-bit relative jump
.macro jmp32 addr
	.byte 0xe9
	.long \addr - . - 4
.endm

.macro isr_thunk n
	pushal
	movl $\n, %eax
	jmp32 intr_dispatch
.endm

.globl intr_vector_base
intr_vector_base:
isr_thunk 0x00
intr_vector_1:
isr_thunk 0x01
isr_thunk 0x02
isr_thunk 0x03
isr_thunk 0x04
isr_thunk 0x05
isr_thunk 0x06
isr_thunk 0x07
isr_thunk 0x08
isr_thunk 0x09
isr_thunk 0x0a
isr_thunk 0x0b
isr_thunk 0x0c
isr_thunk 0x0d
isr_thunk 0x0e
isr_thunk 0x0f
isr_thunk 0x10
isr_thunk 0x11
isr_thunk 0x12
isr_thunk 0x13
isr_thunk 0x14
isr_thunk 0x15
isr_thunk 0x16
isr_thunk 0x17
isr_thunk 0x18
isr_thunk 0x19
isr_thunk 0x1a
isr_thunk 0x1b
isr_thunk 0x1c
isr_thunk 0x1d
isr_thunk 0x1e
isr_thunk 0x1f
isr_thunk 0x20
isr_thunk 0x21
isr_thunk 0x22
isr_thunk 0x23
isr_thunk 0x24
isr_thunk 0x25
isr_thunk 0x26
isr_thunk 0x27
isr_thunk 0x28
isr_thunk 0x29
isr_thunk 0x2a
isr_thunk 0x2b
isr_thunk 0x2c
isr_thunk 0x2d
isr_thunk 0x2e
isr_thunk 0x2f
isr_thunk 0x30
isr_thunk 0x31
isr_thunk 0x32
isr_thunk 0x33
isr_thunk 0x34
isr_thunk 0x35
isr_thunk 0x36
isr_thunk 0x37
isr_thunk 0x38
isr_thunk 0x39
isr_thunk 0x3a
isr_thunk 0x3b
isr_thunk 0x3c
isr_thunk 0x3d
isr_thunk 0x3e
isr_thunk 0x3f
isr_thunk 0x40
isr_thunk 0x41
isr_thunk 0x42
isr_thunk 0x43
isr_thunk 0x44
isr_thunk 0x45
isr_thunk 0x46
isr_thunk 0x47
isr_thunk 0x48
isr_thunk 0x49
isr_thunk 0x4a
isr_thunk 0x4b
isr_thunk 0x4c
isr_thunk 0x4d
isr_thunk 0x4e
isr_thunk 0x4f
isr_thunk 0x50
isr_thunk 0x51
isr_thunk 0x52
isr_thunk 0x53
isr_thunk 0x54
isr_thunk 0x55
isr_thunk 0x56
isr_thunk 0x57
isr_thunk 0x58
isr_thunk 0x59
isr_thunk 0x5a
isr_thunk 0x5b
isr_thunk 0x5c
isr_thunk 0x5d
isr_thunk 0x5e
isr_thunk 0x5f
isr_thunk 0x60
isr_thunk 0x61
isr_thunk 0x62
isr_thunk 0x63
isr_thunk 0x64
isr_thunk 0x65
isr_thunk 0x66
isr_thunk 0x67
isr_thunk 0x68
isr_thunk 0x69
isr_thunk 0x6a
isr_thunk 0x6b
isr_thunk 0x6c
isr_thunk 0x6d
isr_thunk 0x6e
isr_thunk 0x6f
isr_thunk 0x70
isr_thunk 0x71
isr_thunk 0x72
isr_thunk 0x73
isr_thunk 0x74
isr_thunk 0x75
isr_thunk 0x76
isr_thunk 0x77
isr_thunk 0x78
isr_thunk 0x79
isr_thunk 0x7a
isr_thunk 0x7b
isr_thunk 0x7c
isr_thunk 0x7d
isr_thunk 0x7e
isr_thunk 0x7f
isr_thunk 0x80
isr_thunk 0x81
isr_thunk 0x82
isr_thunk 0x83
isr_thunk 0x84
isr_thunk 0x85
isr_thunk 0x86
isr_thunk 0x87
isr_thunk 0x88
isr_thunk 0x89
isr_thunk 0x8a
isr_thunk 0x8b
isr_thunk 0x8c
isr_thunk 0x8d
isr_thunk 0x8e
isr_thunk 0x8f
isr_thunk 0x90
isr_thunk 0x91
isr_thunk 0x92
isr_thunk 0x93
isr_thunk 0x94
isr_thunk 0x95
isr_thunk 0x96
isr_thunk 0x97
isr_thunk 0x98
isr_thunk 0x99
isr_thunk 0x9a
isr_thunk 0x9b
isr_thunk 0x9c
isr_thunk 0x9d
isr_thunk 0x9e
isr_thunk 0x9f
isr_thunk 0xa0
isr_thunk 0xa1
isr_thunk 0xa2
isr_thunk 0xa3
isr_thunk 0xa4
isr_thunk 0xa5
isr_thunk 0xa6
isr_thunk 0xa7
isr_thunk 0xa8
isr_thunk 0xa9
isr_thunk 0xaa
isr_thunk 0xab
isr_thunk 0xac
isr_thunk 0xad
isr_thunk 0xae
isr_thunk 0xaf
isr_thunk 0xb0
isr_thunk 0xb1
isr_thunk 0xb2
isr_thunk 0xb3
isr_thunk 0xb4
isr_thunk 0xb5
isr_thunk 0xb6
isr_thunk 0xb7
isr_thunk 0xb8
isr_thunk 0xb9
isr_thunk 0xba
isr_thunk 0xbb
isr_thunk 0xbc
isr_thunk 0xbd
isr_thunk 0xbe
isr_thunk 0xbf
isr_thunk 0xc0
isr_thunk 0xc1
isr_thunk 0xc2
isr_thunk 0xc3
isr_thunk 0xc4
isr_thunk 0xc5
isr_thunk 0xc6
isr_thunk 0xc7
isr_thunk 0xc8
isr_thunk 0xc9
isr_thunk 0xca
isr_thunk 0xcb
isr_thunk 0xcc
isr_thunk 0xcd
isr_thunk 0xce
isr_thunk 0xcf
isr_thunk 0xd0
isr_thunk 0xd1
isr_thunk 0xd2
isr_thunk 0xd3
isr_thunk 0xd4
isr_thunk 0xd5
isr_thunk 0xd6
isr_thunk 0xd7
isr_thunk 0xd8
isr_thunk 0xd9
isr_thunk 0xda
isr_thunk 0xdb
isr_thunk 0xdc
isr_thunk 0xdd
isr_thunk 0xde
isr_thunk 0xdf
isr_thunk 0xe0
isr_thunk 0xe1
isr_thunk 0xe2
isr_thunk 0xe3
isr_thunk 0xe4
isr_thunk 0xe5
isr_thunk 0xe6
isr_thunk 0xe7
isr_thunk 0xe8
isr_thunk 0xe9
isr_thunk 0xea
isr_thunk 0xeb
isr_thunk 0xec
isr_thunk 0xed
isr_thunk 0xee
isr_thunk 0xef
isr_thunk 0xf0
isr_thunk 0xf1
isr_thunk 0xf2
isr_thunk 0xf3
isr_thunk 0xf4
isr_thunk 0xf5
isr_thunk 0xf6
isr_thunk 0xf7
isr_thunk 0xf8
isr_thunk 0xf9
isr_thunk 0xfa
isr_thunk 0xfb
isr_thunk 0xfc
isr_thunk 0xfd
isr_thunk 0xfe
isr_thunk 0xff

.data
.global intr_thunk_size
intr_thunk_size:
.long intr_vector_1 - intr_vector_base
